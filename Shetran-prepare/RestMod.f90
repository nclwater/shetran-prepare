module RestMod
    implicit none
    contains


      subroutine rootdensity(rdf)
      
      real rdf(50,50)
      real rdf1(50),rdf2(50),rdf3(50),rdf4(50)
      real rdf5(50),rdf6(50),rdf7(50),rdf8(50)
      real rdf9(50),rdf10(50),rdf11(50),rdf12(50)
      real rdf13(50),rdf14(50),rdf15(50),rdf16(50)
      real rdf17(50),rdf18(50),rdf19(50),rdf20(50)
      real rdf21(50),rdf22(50),rdf23(50),rdf24(50)
      real rdf25(50),rdf26(50),rdf27(50)
      integer i,j

      
      rdf1(1:27)=(/1.0,0.85,0.7,0.55,0.4,0.37,0.34,0.31,0.28,0.25,0.226,0.202,0.178,0.154,0.13,0.126,0.122,0.118,0.114,0.11,0.1064,0.1028,0.0992,0.0968,0.0932,0.0896,0.086/)
      rdf2(1:27)=(/0.0,0.15,0.2,0.25,0.3,0.276,0.252,0.228,0.204,0.18,0.168,0.156,0.144,0.132,0.12,0.115,0.11,0.105,0.1,0.095,0.092,0.089,0.086,0.084,0.081,0.078,0.075 /)
      rdf3(1:27)=(/0.0,0.0,0.1,0.15,0.2,0.19,0.18,0.17,0.16,0.15,0.142,0.134,0.126,0.118,0.11,0.1046,0.0992,0.0938,0.0884,0.083,0.08105,0.0791,0.07715,0.07585,0.0739,0.07195,0.07 /)
      rdf4(1:27)=(/0.0,0.0,0.0,0.05,0.07,0.08,0.09,0.1,0.11,0.12,0.116,0.112,0.108,0.104,0.1,0.0944,0.0888,0.0832,0.0776,0.072,0.07095,0.0699,0.06885,0.06815,0.0671,0.06605,0.065 /)
      rdf5(1:27)=(/0.0,0.0,0.0,0.0,0.03,0.054,0.068,0.072,0.086,0.1,0.098,0.096,0.094,0.092,0.09,0.085,0.08,0.075,0.07,0.065,0.06425,0.0635,0.06275,0.06225,0.0615,0.06075,0.06 /)
      rdf6(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.03,0.04,0.06,0.07,0.08,0.08,0.08,0.08,0.08,0.08,0.076,0.072,0.068,0.064,0.06,0.05925,0.0585,0.05775,0.05725,0.0565,0.05575,0.055 /)
      rdf7(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.03,0.04,0.05,0.06,0.062,0.064,0.066,0.068,0.07,0.067,0.064,0.061,0.058,0.055,0.05425,0.0535,0.05275,0.05225,0.0515,0.05075,0.05 /)
      rdf8(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.02,0.024,0.03,0.04,0.046,0.052,0.056,0.06,0.058,0.056,0.054,0.052,0.05,0.04925,0.0485,0.04775,0.04725,0.0465,0.04575,0.045 /)
      rdf9(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.016,0.02,0.03,0.035,0.04,0.045,0.05,0.049,0.048,0.047,0.046,0.045,0.04425,0.0435,0.04275,0.04225,0.0415,0.04075,0.04 /)
      rdf10(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.01,0.02,0.025,0.027,0.029,0.03,0.032,0.034,0.036,0.038,0.04,0.03925,0.0385,0.03775,0.03725,0.0365,0.03575,0.035 /)
      rdf11(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.018,0.03, 0.04,0.048,0.06,0.062,0.064,0.066,0.068,0.07,0.0685,0.067,0.0655,0.0645,0.063,0.0615,0.06 /)
      rdf12(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.02,0.027,0.032,0.04,0.044,0.048,0.052,0.056,0.06,0.05925,0.0585,0.05775,0.05725,0.0565,0.05575,0.055 /)
      rdf13(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.018,0.026,0.03,0.034, 0.038,0.042,0.046,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05 /)
      rdf14(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.016,0.02,0.024,0.028,0.032,0.036,0.04,0.04075,0.0415,0.04225,0.04275,0.0435,0.04425,0.045 /)
      rdf15(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.01,0.018,0.022,0.025,0.028,0.03,0.0315,0.033,0.0345,0.0355,0.037,0.0385,0.04 /)
      rdf16(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.011,0.014,0.018,0.021,0.025,0.0265,0.028,0.0295,0.0305,0.032,0.0335,0.035 /)
      rdf17(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.012,0.014,0.017,0.02,0.0215,0.023,0.0245,0.0255,0.027,0.0285,0.03 /)
      rdf18(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.01,0.012,0.015,0.0165,0.018,0.0195,0.0205,0.022,0.0235,0.025/)
      rdf19(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.008,0.01,0.012,0.013,0.014,0.0155,0.017,0.0185,0.02/)
      rdf20(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.005,0.007,0.009,0.011,0.012,0.014,0.015,0.016/)
      rdf21(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0056,0.007,0.009,0.0095,0.01,0.011,0.012/)
      rdf22(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0052,0.006,0.007,0.008,0.009,0.01/)
      rdf23(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0038,0.005,0.006,0.007,0.008/)
      rdf24(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0012,0.003,0.005,0.006/)
      rdf25(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0018,0.0034,0.004/)
      rdf26(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0005,0.002/)
      rdf27(1:27)=(/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.001/)


      
      
      
      
      
    do j=1,27
        rdf(1,j)= rdf1(j)
        rdf(2,j)= rdf2(j)
        rdf(3,j)= rdf3(j)
        rdf(4,j)= rdf4(j)
        rdf(5,j)= rdf5(j)
        rdf(6,j)= rdf6(j)
        rdf(7,j)= rdf7(j)
        rdf(8,j)= rdf8(j)
        rdf(9,j)= rdf9(j)
        rdf(10,j)= rdf10(j)
        rdf(11,j)= rdf11(j)
        rdf(12,j)= rdf12(j)
        rdf(13,j)= rdf13(j)
        rdf(14,j)= rdf14(j)
        rdf(15,j)= rdf15(j)
        rdf(16,j)= rdf16(j)
        rdf(17,j)= rdf17(j)
        rdf(18,j)= rdf18(j)
        rdf(19,j)= rdf19(j)
        rdf(20,j)= rdf20(j)
        rdf(21,j)= rdf21(j)
        rdf(22,j)= rdf22(j)
        rdf(23,j)= rdf23(j)
        rdf(25,j)= rdf25(j)
        rdf(26,j)= rdf26(j)
        rdf(27,j)= rdf27(j)
    enddo
          
    return
    end subroutine rootdensity


! sb changed form on 021009
!***********************************************************************
 function form(number) result(res)
    implicit none  
    character(len=7) :: res
      
! Calculates the format a real number is to be printed out in

! there is an error with 9.96*10-10 try this correction


      real number

      if (NUMBER.LE.-9.949E9) then
         write(res,'(1P,E7.0E2)') NUMBER
      elseif ((NUMBER.GE.-9.949E9).AND.(NUMBER.LT.-9999.49)) then
         write(res,'(1P,E7.1E1)') NUMBER
      elseif ((NUMBER.GE.-9999.49).AND.(NUMBER.LT.-999.949)) then
         write(res,'(1X,F6.0)') NUMBER
      elseif ((NUMBER.GE.-999.949).AND.(NUMBER.LT.-99.9949)) then
         write(res,'(1X,F6.1)') NUMBER
      elseif ((NUMBER.GE.-99.9949).AND.(NUMBER.LT.-9.99949)) then
         write(res,'(1X,F6.2)') NUMBER
      elseif ((NUMBER.GE.-9.99949).AND.(NUMBER.LT.-0.00949)) then
         write(res,'(1X,F6.3)') NUMBER
      elseif ((NUMBER.GE.-0.00949).AND.(NUMBER.LT.-9.49E-10)) then
         write(res,'(1P,E7.1E1)') NUMBER
      elseif ((NUMBER.GE.-9.49E-10).AND.(NUMBER.LT.0)) then
         write(res,'(1P,E7.0E2)') NUMBER
      elseif (NUMBER.EQ.0) then
         write(res,'(4X,A3)') '0.0'
!      elseif ((NUMBER.GT.0).AND.(NUMBER.LT.9.949E-10)) then
!         write(res,'(1P,E7.1E2)') NUMBER
!      elseif ((NUMBER.GE.9.949E-10).AND.(NUMBER.LT.0.000949)) then
      elseif ((NUMBER.GT.0).AND.(NUMBER.LT.9.9999E-10)) then
         write(res,'(1P,E7.1E2)') NUMBER
      elseif ((NUMBER.GE.9.9999E-10).AND.(NUMBER.LT.0.000949)) then
         write(res,'(1P,E7.2E1)') NUMBER
      elseif ((NUMBER.GE.0.000949).AND.(NUMBER.LT.9.999949)) then
         write(res,'(1X,F6.4)') NUMBER
      elseif ((NUMBER.GE.9.999949).AND.(NUMBER.LT.99.99949)) then
         write(res,'(1X,F6.3)') NUMBER
      elseif ((NUMBER.GE.99.99949).AND.(NUMBER.LT.999.9949)) then
         write(res,'(1X,F6.2)') NUMBER
      elseif ((NUMBER.GE.999.9949).AND.(NUMBER.LT.9999.949)) then
         write(res,'(1X,F6.1)') NUMBER
      elseif ((NUMBER.GE.9999.949).AND.(NUMBER.LT.99999.49)) then
         write(res,'(1X,F6.0)') NUMBER
      elseif ((NUMBER.GE.99999.49).AND.(NUMBER.LT.9.9949E9)) then
         write(res,'(1P,E7.2E1)') NUMBER
      elseif (NUMBER.GE.9.9949E9) then
         write(res,'(1P,E7.1E2)') NUMBER
        
      endif
      
 end function form
 
 
 !FFFFFF DOUBLEPRECISION FUNCTION hour_from_date
 FUNCTION hour_from_date(KYEAR, KMTH, KDAY, KHOUR, KMIN)  RESULT(r)
!----------------------------------------------------------------------*
!  THIS FUNCTION CALCULATES HOURS SINCE 1.JANUARY YEAR 1950 AT 0 HOUR
!  LEAP YEARS ARE TAKEN INTO ACCOUNT
!----------------------------------------------------------------------*
! Entry requirements:
!  KYEAR.ge.1949    KMTH.ge.1    KMTH.le.12
    INTEGER         :: kyear, kmth, kday, khour, kmin
    INTEGER         :: d, check(6)
    DOUBLEPRECISION :: r
    d = DAYS_IN_YEARS_SINCE_1950(kyear)+ DAYS_TO_START_MONTH(kmth, kyear) + kday
    r = DBLE(d*24 + khour) + DBLE(kmin) / 6d1
    r= r+ 0.0000028  !add 1/100 of a second to sort out round error with mins
        !     * days arising from entire years (asasuming KYEAR.ge.1949) ...
        !mmday = (kyear - 1950) * 365 + (kyear - 1949) / 4  
        !     * ... plus entire days this year (not including today) ...
        !mmday = mmday + mdays(kmth) + kday - 1  
        !     * ... not forgetting that MDAYS is defined for non-leap years
       !IF (MOD (KYEAR,4) .EQ.0.AND.KMTH.GT.2) mmday = mmday + 1
END FUNCTION hour_from_date

!FFFFFF FUNCTION days_in_years_since_1950
FUNCTION days_in_years_since_1950(y) RESULT(r)
    INTEGER, INTENT(IN) :: y
    INTEGER             :: i, r
    r = (y - 1950) * 365
    DO i=1952, y-1, 4
        IF(IS_LEAP(i)) r=r+1
    ENDDO
END FUNCTION days_in_years_since_1950


!FFFFFF FUNCTION is_leap
FUNCTION is_leap(y) RESULT(r)
!A year will be a leap year if it is divisible by 4 but not by 100. 
!If a year is divisible by 4 and by 100, it is not a leap year unless it is also divisible by 400.
    INTEGER, INTENT(IN) :: y
    LOGICAL  :: r
    IF(MOD(y,4)==0) THEN
        IF(MOD(y,100)==0) THEN
           r = MOD(y,400)==0
        ELSE
            r = .TRUE.
        ENDIF
    ELSE
        r = .FALSE.
    ENDIF
END FUNCTION is_leap


!FFFFFF FUNCTION days_to_start_month
FUNCTION days_to_start_month(m, y) RESULT(r)
    INTEGER, INTENT(IN) :: m, y
    INTEGER, PARAMETER  ::  sd(12)=[0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334]
    INTEGER             :: r
    IF(M<1) THEN
        write (*,*) 'the month is less than 1'
        STOP
    ENDIF
    r = sd(m)
    IF(IS_LEAP(y).AND. m>2) r = r + 1
END FUNCTION days_to_start_month


! ***** test precipitation data from Foston catchment in Yorkshipe for 1/1/1980-1/1/1981
subroutine PrecipTest(PrecipTestData)

    real :: PrecipTestData(365)

    PrecipTestData(1:365)=(/0.7,5.3,17.9,0.9,0.0,1.6,0.2,1.1,0.8,0.0,0.0,0.0,0.2,14.9,2.9,2.0,0.2,0.0,2.3,8.3,4.2,4.8,0.1,0.0,0.1,0.2,6.4,5.4,6.7,13.8,12.8,5.0,3.7,1.0,14.9,4.2,4.3, &
        8.8,1.3,0.2,0.0,0.0,0.0,0.0,3.4,0.3,0.0,0.0,0.0,0.0,0.0,5.0,13.7,0.2,0.1,1.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,3.0,0.0,0.1,6.5,3.9,9.2,11.0,0.1,1.2,0.2,9.4,19.8,1.0,1.4,0.7,0.0,0.0,0.0,7.1,1.4,6.9,1.6, &
        9.9,0.1,0.0,0.8,0.0,1.7,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.1,0.9,0.0,0.7,3.4,0.3,0.0,2.9,1.2,0.0,5.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.2,0.1,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.7,0.8,0.0,0.7,0.0,0.0,0.0, &
        0.6,1.5,2.1,1.2,0.0,4.2,1.3,0.7,0.0,0.0,0.1,0.0,2.4,1.9,2.8,1.0,1.7,1.3,2.9,12.1,2.3,12.2,0.5,0.0,0.8,0.3,0.1,2.7,8.4,3.2,16.2,5.3,4.3,0.5,0.1,24.3,1.7,0.0,0.0,0.3,1.9,0.9, &
        0.3,5.9,0.0,0.1,0.2,3.8,0.3,1.8,0.2,0.0,5.8,2.7,2.3,0.5,0.0,0.0,0.0,0.0,0.0,6.8,0.0,0.0,7.3,3.4,0.0,3.9,1.7,1.7,0.8,0.1,7.5,12.8,0.1,0.0,0.2,6.9,0.0,0.0,43.4,5.4,0.1,0.5,0.4,1.0,7.9,0.0,0.0, &
        4.9,0.0,0.0,0.0,0.0,0.1,17.9,2.2,0.0,0.0,0.0,0.0,0.3,3.3,0.0,0.0,0.0,0.0,0.6,3.3,0.0,2.0,3.3,0.0,11.6,0.0,0.4,0.0,0.5,0.0,0.9,0.8,0.0,0.0,0.2,5.7,2.2,0.6,0.0,0.0,0.0,3.7,0.0,0.6,13.1,1.8,0.0,0.0,6.4,0.9,0.0,0.1,6.1,&
        4.9,18.9,12.0,3.0,0.4,4.7,3.5,6.3,16.4,11.6,2.3,10.8,7.7,2.0,0.0,0.0,0.0,0.0,0.0,0.0,0.6,2.2,1.0,2.4,2.8,2.4,0.8,0.5,0.0,1.9,6.8,5.8,1.8,6.2,3.7,0.8,1.1,2.7,0.0,2.6,2.6,9.5,0.1,2.6,8.7, &
        2.3,0.0,0.3,6.9,5.3,5.7,0.9,6.5,0.8,0.1,0.0,3.9,0.6,1.1,0.2,2.2,0.3,2.0,1.4,0.0,8.8,2.0,0.2,0.6,0.0,6.2,0.9,0.1,0.1,0.0,0.0,0.3/)


end subroutine PrecipTest
 
! ***** test PET data from Foston catchment in Yorkshipe for 1/1/1980-1/1/1981
 subroutine PetTest(PetTestData)

    real :: PetTestData(365)

    PetTestData(1:365)=(/0.36,0.37,0.46,0.48,0.51,0.52,0.5,0.46,0.44,0.46,0.43,0.45,0.42,0.44,0.49,0.5,0.49,0.45,0.44,0.48,0.51,0.51,0.54,0.53,0.5,0.48,0.48,0.52,0.58,0.63,0.55,0.37,0.39,0.42,0.47,0.48,0.48,0.54,0.6,0.67,0.61, &
    0.63,0.6,0.62,0.64,0.65,0.59,0.68,0.66,0.61,0.59,0.65,0.69,0.68,0.66,0.64,0.62,0.61,0.65,0.72,1.19,1.09,0.94,0.99,1.0,1.09,1.11,1.14,1.14,1.06,1.18,1.27,1.1,1.03,1.02,1.06,1.03,1.03,0.93,0.94,0.95,1.03,1.06,1.27,1.36,1.39,1.45, &
    1.26,1.28,1.4,1.4,1.99,1.91,1.81,1.87,2.0,2.02,1.95,1.79,1.81,1.99,2.14,2.24,2.58,2.55,2.43,2.83,2.26,2.66,2.21,1.84,2.1,2.14,2.37,2.18,2.03,1.93,2.18,2.2,2.21,2.11,2.54,2.65,2.6,2.49,2.57,2.38,2.5,2.5,2.59,2.9,3.0,3.12,3.2,3.13, &
    3.13,3.28,3.29,3.4,3.62,3.36,3.05,3.03,3.07,3.26,3.36,3.42,3.46,3.24,3.0,2.98,3.07,2.75,2.85,3.45,3.66,3.65,3.16,2.9,2.96,2.91,2.94,2.79,2.85,2.75,2.99,3.2,3.01,3.03,3.15,3.0,2.71,2.79,2.75,2.74,2.76,2.68,2.63,2.77,2.76,2.77,2.65, &
    2.58,2.81,2.93,3.01,2.92,2.82,2.86,2.76,2.71,2.7,2.66,2.8,2.74,2.72,2.59,2.64,2.62,2.96,3.06,2.65,2.67,2.99,3.22,3.05,3.14,3.25,3.31,3.31,3.05,3.26,3.05,2.86,2.77,3.01,2.99,2.89,2.56,2.63,2.52,2.41,2.72,2.68,2.42,2.67,2.95,2.78,  &
    2.88,2.68,2.69,2.6,2.67,2.38,2.21,2.18,2.27,2.3,2.42,2.41,2.63,2.33,2.29,2.25,2.48,2.71,2.65,2.55,2.35,2.49,2.54,2.49,2.16,2.24,2.15,2.19,2.11,2.2,2.17,2.32,2.09,2.11,2.33,2.13,2.33,2.21,2.08,2.02,1.89,2.0,2.03,1.87,1.75,1.81,1.64, &
    1.61,1.56,1.51,1.37,1.51,1.29,1.32,1.31,1.21,1.31,1.27,1.23,1.31,1.2,1.11,1.12,1.06,1.01,1.02,1.19,1.34,1.25,1.17,1.07,1.26,1.36,1.34,1.19,0.97,0.98,0.99,0.95,0.85,0.91,0.93,0.93,0.93,0.94,0.9,0.87,0.9,0.86,0.89,1.05,1.09,1.2,1.18, &
    0.94,1.0,1.02,1.17,1.19,1.18,1.15,0.92,0.76,0.76,0.68,0.67,0.7,0.64,0.68,0.68,0.76,0.81,0.66,0.61,0.6,0.71,0.93,0.94,0.93,1.01,0.92,0.73,0.78,0.83,0.72,0.61,0.66,0.75,0.89,1.0,0.96,0.79,0.67,0.72,0.8,0.92,0.97/)


end subroutine PetTest


end module RestMod
